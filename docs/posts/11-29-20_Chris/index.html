<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Machine Learning for Educational Data Science Blog: XG Boost</title>

<meta property="description" itemprop="description" content="Tuning process and final model summary"/>

<link rel="canonical" href="https://github.com/aashayadav/posts/11-29-20_Chris/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2020-11-28"/>
<meta property="article:created" itemprop="dateCreated" content="2020-11-28"/>
<meta name="article:author" content="Chris Ives"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Machine Learning for Educational Data Science Blog: XG Boost"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Tuning process and final model summary"/>
<meta property="og:url" content="https://github.com/aashayadav/posts/11-29-20_Chris/"/>
<meta property="og:image" content="https://github.com/aashayadav/posts/11-29-20_Chris/ML_models_files/figure-html5/unnamed-chunk-5-1.png"/>
<meta property="og:image:width" content="1536"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Machine Learning for Educational Data Science Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Machine Learning for Educational Data Science Blog: XG Boost"/>
<meta property="twitter:description" content="Tuning process and final model summary"/>
<meta property="twitter:url" content="https://github.com/aashayadav/posts/11-29-20_Chris/"/>
<meta property="twitter:image" content="https://github.com/aashayadav/posts/11-29-20_Chris/ML_models_files/figure-html5/unnamed-chunk-5-1.png"/>
<meta property="twitter:image:width" content="1536"/>
<meta property="twitter:image:height" content="768"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["XG Boost"]},{"type":"character","attributes":{},"value":["Tuning process and final model summary"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Chris Ives"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["University of Oregon"]},{"type":"NULL"}]}]},{"type":"character","attributes":{},"value":["11-28-2020"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://github.com/aashayadav/posts/11-29-20_Chris/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["blog_model.Rds","blog_predictions.csv","data/bonus_data_v2.csv","data/disc_drop.csv","data/train.csv","late_model_submit_1207.Rds","ML_models_files/anchor-4.2.2/anchor.min.js","ML_models_files/bowser-1.9.3/bowser.min.js","ML_models_files/crosstalk-1.1.0.1/css/crosstalk.css","ML_models_files/crosstalk-1.1.0.1/js/crosstalk.js","ML_models_files/crosstalk-1.1.0.1/js/crosstalk.js.map","ML_models_files/crosstalk-1.1.0.1/js/crosstalk.min.js","ML_models_files/crosstalk-1.1.0.1/js/crosstalk.min.js.map","ML_models_files/distill-2.2.21/template.v2.js","ML_models_files/figure-html5/unnamed-chunk-12-1.png","ML_models_files/figure-html5/unnamed-chunk-13-1.png","ML_models_files/figure-html5/unnamed-chunk-24-1.png","ML_models_files/figure-html5/unnamed-chunk-5-1.png","ML_models_files/figure-html5/unnamed-chunk-6-1.png","ML_models_files/htmlwidgets-1.5.2/htmlwidgets.js","ML_models_files/jquery-1.11.3/jquery-AUTHORS.txt","ML_models_files/jquery-1.11.3/jquery.js","ML_models_files/jquery-1.11.3/jquery.min.js","ML_models_files/jquery-1.11.3/jquery.min.map","ML_models_files/plotly-binding-4.9.2.1/plotly.js","ML_models_files/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css","ML_models_files/plotly-main-1.52.2/plotly-latest.min.js","ML_models_files/typedarray-0.1/typedarray.min.js","ML_models_files/webcomponents-2.0.0/webcomponents.js","model_submit_1207.Rds"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
  <script src="../../site_libs/plotly-binding-4.9.2.1/plotly.js"></script>
  <script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="../../site_libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
  <script src="../../site_libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
  <link href="../../site_libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
  <script src="../../site_libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"XG Boost","description":"Tuning process and final model summary","authors":[{"author":"Chris Ives","authorURL":"#","affiliation":"University of Oregon","affiliationURL":"#","orcidID":""}],"publishedDate":"2020-11-28T00:00:00.000-08:00","citationText":"Ives, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Machine Learning for Educational Data Science Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="https://github.com/aashayadav/Machine-Learning-Blog">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="https://www.kaggle.com/c/edld-654-fall-2020/overview">kaggle</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>XG Boost</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Tuning process and final model summary</p></p>
</div>

<div class="d-byline">
  Chris Ives  (University of Oregon)
  
<br/>11-28-2020
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#data-import">Data Import</a></li>
<li><a href="#recipe">Recipe</a><ul>
<li><a href="#recipe-notes">Recipe Notes</a></li>
</ul></li>
<li><a href="#tuning-hyperparameters">Tuning Hyperparameters</a><ul>
<li><a href="#approach-1-tuning-gamma-first">Approach #1: Tuning Gamma First</a><ul>
<li><a href="#tuning-results">Tuning Results</a></li>
</ul></li>
<li><a href="#follow-up-tree-parameter-tuning">Follow-up Tree-Parameter Tuning</a><ul>
<li><a href="#create-grid">Create Grid</a></li>
<li><a href="#specify-model">Specify Model</a></li>
<li><a href="#tuning-results-1">Tuning Results</a></li>
</ul></li>
<li><a href="#approach-2-tuning-tree-parameters-first">Approach #2: Tuning Tree Parameters First</a><ul>
<li><a href="#specify-model-1">Specify Model</a></li>
<li><a href="#tuning-results-2">Tuning Results</a></li>
<li><a href="#followup-gamma-tuning">Followup Gamma Tuning</a></li>
<li><a href="#fine-tuning-gamma">Fine Tuning Gamma</a></li>
</ul></li>
<li><a href="#evaluating-approaches">Evaluating Approaches</a></li>
<li><a href="#tune-stochastic-parameters">Tune Stochastic Parameters</a><ul>
<li><a href="#specify-model-2">Specify Model</a></li>
<li><a href="#tuning-results-3">Tuning Results</a></li>
</ul></li>
<li><a href="#retune-learning-rate">Retune Learning Rate</a><ul>
<li><a href="#specify-model-3">Specify Model</a></li>
</ul></li>
</ul></li>
<li><a href="#tune-number-of-trees">Tune Number of Trees</a></li>
<li><a href="#final-fit-statistics">Final Fit Statistics</a><ul>
<li><a href="#generate-final-fit">Generate Final Fit</a></li>
<li><a href="#fit-to-test-set">Fit to test set</a></li>
<li><a href="#final-fit-results">Final Fit Results</a></li>
<li><a href="#feature-importance-plot-of-final-model-top-35">Feature Importance Plot of Final Model (Top 35)</a></li>
</ul></li>
</ul>
</nav>
</div>
<h2 id="data-import">Data Import</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"data/train.csv"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>classification</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='va'>is.character</span>, <span class='va'>factor</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ncessch <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>ncessch</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>bonus</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"data/bonus_data_v2.csv"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ncessch <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>ncessch</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>locale <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"^.{0,3}"</span>, <span class='st'>""</span>, <span class='va'>locale</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>separate</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>locale</span>, into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"locale"</span>, <span class='st'>"sublocale"</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>": "</span><span class='op'>)</span>

<span class='va'>disc</span> <span class='op'>&lt;-</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='st'>"data/disc_drop.csv"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>attnd_dist_inst_id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/double.html'>as.double</a></span><span class='op'>(</span><span class='va'>attnd_dist_inst_id</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## join data</span>
<span class='va'>data</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>bonus</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>disc</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Data was merged from three files:</p>
<ul>
<li><p>Original Competition Training Dataset</p></li>
<li><p>“Bonus Dataset” with additional variables collected by zip code, NCES school IDs, state school IDs, and county levels</p></li>
<li><p>Supplemental small dataset of high school dropout rates and out-of-school suspension rates by state district IDs</p>
<ul>
<li>Dropout Rate Data Source: <a href="https://www.oregon.gov/ode/reports-and-data/students/Pages/Dropout-Rates.aspx" class="uri">https://www.oregon.gov/ode/reports-and-data/students/Pages/Dropout-Rates.aspx</a></li>
<li>Suspension Rate Data Source: <a href="https://www.oregon.gov/ode/students-and-family/healthsafety/Pages/School-Discipline,-Bullying,-Restraint-and-Seclusion.aspx" class="uri">https://www.oregon.gov/ode/students-and-family/healthsafety/Pages/School-Discipline,-Bullying,-Restraint-and-Seclusion.aspx</a></li>
</ul></li>
</ul>
<p>Importantly, the bonus data includes the variables described in the original data description page, as well as the following:</p>
<ul>
<li>2016-2017 District Finance Data:
<ul>
<li>Total revenue (<code>rev_total</code>)</li>
<li>Total local revenue (<code>rev_local_total</code>)</li>
<li>Total state revenue (<code>rev_state_total</code>)</li>
<li>Total federal revenue (<code>rev_fed_total</code>)</li>
<li>Total expenditures (<code>exp_total</code>)</li>
<li>Total current expenditures for elementary and secondary education (<code>exp_current_elsec_total</code>)</li>
<li>Total current expenditures for instruction (<code>exp_current_instruction_total</code>)</li>
<li>Total current expenditures for support services (<code>exp_current_supp_serve_total</code>)</li>
<li>Total capital outlay expenditures (<code>outlay_capital_total</code>)</li>
<li>Total salary amount (<code>salaries_total</code>)</li>
<li>Total employee benefits in dollars (<code>benefits_employee_total</code>)</li>
<li>Number of students for which the reporting local education agency is financially responsible (<code>enrollment_fall_responsible</code>)</li>
</ul></li>
</ul>
<p>District financial data was obtained using the <code>educationdata</code> R package.</p>
<p>Lastly, district finance data was included in both its raw form, and transformed by dividing each revenue and expenditure value by the number of students the LEA was financially responsible for (e.g., <code>exp_total</code>/<code>enrollment_fall_responsible</code>)</p>
<h1 id="recipe">Recipe</h1>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>rec</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>score</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>train</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_mutate</span><span class='op'>(</span>tst_dt <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd_hms.html'>mdy_hms</a></span><span class='op'>(</span><span class='va'>tst_dt</span><span class='op'>)</span><span class='op'>)</span>,
              lang_cd <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>lang_cd</span> <span class='op'>==</span> <span class='st'>"S"</span> <span class='op'>~</span> <span class='st'>"S"</span>, <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"E"</span><span class='op'>)</span>,
              pupil_tch_ratio <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>pupil_tch_ratio</span><span class='op'>)</span>,
              pupil_tch_ratio <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>pupil_tch_ratio</span><span class='op'>)</span>,
              pupil_tch_rate <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>pupil_tch_ratio</span> <span class='op'>&lt;</span> <span class='fl'>18</span> <span class='op'>~</span> <span class='fl'>1</span>,
                                         <span class='va'>pupil_tch_ratio</span> <span class='op'>&lt;</span> <span class='fl'>25</span> <span class='op'>~</span> <span class='fl'>2</span>,
                                         <span class='va'>pupil_tch_ratio</span> <span class='op'>&lt;</span> <span class='fl'>30</span> <span class='op'>~</span> <span class='fl'>3</span>, 
                                         <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='fl'>4</span><span class='op'>)</span>,
              pupil_tch_rate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>pupil_tch_rate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_rm</span><span class='op'>(</span><span class='fu'>contains</span><span class='op'>(</span><span class='st'>"id"</span><span class='op'>)</span>, <span class='va'>ncessch</span>, <span class='va'>ncesag</span>, <span class='va'>lea_name</span>, <span class='va'>sch_name</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_mutate</span><span class='op'>(</span>hpi <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>hpi</span><span class='op'>)</span>,
              lat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>lat</span>, <span class='fl'>2</span><span class='op'>)</span>,
              lon <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>lon</span>, <span class='fl'>2</span><span class='op'>)</span>,
              median_income <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>median_income</span><span class='op'>)</span>,
              frl_prop <span class='op'>=</span> <span class='va'>fr_lnch_prop</span> <span class='op'>+</span> <span class='va'>red_lnch_prop</span>,
              schl_perf <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>sch_percent_level_1</span> <span class='op'>+</span> <span class='va'>sch_percent_level_2</span> <span class='op'>&gt;</span> <span class='va'>sch_percent_level_3</span> <span class='op'>+</span> <span class='va'>sch_percent_level_4</span> <span class='op'>~</span> <span class='fl'>1</span>,
                                    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='fl'>0</span><span class='op'>)</span>,
              over_100 <span class='op'>=</span> <span class='va'>under_200</span> <span class='op'>+</span> <span class='va'>over_200</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_interact</span><span class='op'>(</span>terms <span class='op'>=</span> <span class='op'>~</span> <span class='va'>lat</span><span class='op'>:</span><span class='va'>lon</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_rm</span><span class='op'>(</span><span class='va'>fr_lnch_prop</span>, <span class='va'>red_lnch_prop</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_string2factor</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_unknown</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_medianimpute</span><span class='op'>(</span><span class='fu'>all_numeric</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span>, one_hot <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_interact</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>exp_current_supp_serve_total.x</span><span class='op'>:</span><span class='va'>sp_ed_fg_Y</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_interact</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>lang_cd_S</span><span class='op'>:</span><span class='va'>p_hispanic_latino</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, freq_cut <span class='op'>=</span> <span class='fl'>995</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>)</span>

<span class='va'>baked_train</span> <span class='op'>&lt;-</span> <span class='fu'>prep</span><span class='op'>(</span><span class='va'>rec</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bake</span><span class='op'>(</span><span class='va'>train</span><span class='op'>)</span>

<span class='va'>train_x</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.matrix.html'>data.matrix</a></span><span class='op'>(</span><span class='va'>baked_train</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>73</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>train_y</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.matrix.html'>data.matrix</a></span><span class='op'>(</span><span class='va'>baked_train</span><span class='op'>[</span>, <span class='fl'>73</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="recipe-notes">Recipe Notes</h2>
<ul>
<li>Pupil/Teacher ratio (<code>pupil_tch_ratio</code>) is binned and treated as a factor to remove noise (<code>pupil_tch_rate</code>). Both ratio and binned version of the variable remain in the data.</li>
<li>ID variables are removed</li>
<li>Latitude (<code>lat</code>) and longitude (<code>lon</code>) are rounded to two decimal places to reduce noise and limit precision to within 2/3 of a mile.</li>
<li>Median income is log transformed, as the variations in income level are expected to have greater effect near the poverty threshold and less effect in higher income brackets.</li>
<li>Free lunch proportions and reduced lunch proportions are collapsed into a single variable <code>frl_prop</code> given their expected similar effects.
<ul>
<li>Free lunch proportions (<code>fr_lnch_prop</code>) and reduced lunch proportions (<code>red_lnch_prop</code>) are removed from the data set in lieu of their combined proportion.</li>
</ul></li>
<li>A dummy coded school-level variable (<code>schl_perf</code>) is created that denotes whether the percentage of students reaching proficiency on the EOY state test exceeds the percentage of students that fall below proficiency standards.</li>
<li>Zero variance predictors are removed</li>
<li>Missing data is median imputed</li>
<li>Explicit interaction is specified between the student-level special education flag and the per-student district expenditures for special services. Th effect of special education status is expected to vary depending on the funding available and potential quality of the district’s special services.</li>
<li>Explicit interaction is specified for the effect of Spanish language code (<code>lang_cd</code>) and percentage of Hispanic/Latino students at the school (<code>p_hispanic_latino</code>). The justification is that Spanish-speaking students are expected to receive less effective supports in schools in which they are a greater minority.</li>
<li>Near-zero variance predictors are removed</li>
</ul>
<h1 id="tuning-hyperparameters">Tuning Hyperparameters</h1>
<p>Because the loss reduction (gamma) and maximum tree depth are highly dependent on one another, two approaches were taken to tune the initial model. One approach involved first tuning loss reduction, followed by tree depth and hessian weights. The other involved tuning tree complexity and hessian weights without any severe loss reduction regularization, and then pruning it back by tuning gamma. All tuning was done using the full training dataset.</p>
<h2 id="approach-1-tuning-gamma-first">Approach #1: Tuning Gamma First</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>baked_train</span> <span class='op'>&lt;-</span> <span class='fu'>prep</span><span class='op'>(</span><span class='va'>rec</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bake</span><span class='op'>(</span><span class='va'>train</span><span class='op'>)</span>

<span class='va'>train_x</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.matrix.html'>data.matrix</a></span><span class='op'>(</span><span class='va'>baked_train</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>73</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>train_y</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.matrix.html'>data.matrix</a></span><span class='op'>(</span><span class='va'>baked_train</span><span class='op'>[</span>, <span class='fl'>73</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>loss_reduction <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>80</span>, <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>gamma_mods</span> <span class='op'>&lt;-</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>grid</span><span class='op'>$</span><span class='va'>loss_reduction</span>, <span class='op'>~</span><span class='op'>{</span>
  <span class='fu'>xgb.cv</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>train_x</span>,
    label <span class='op'>=</span> <span class='va'>train_y</span>,
    nrounds <span class='op'>=</span> <span class='fl'>10000</span>,
    objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
    early_stopping_rounds <span class='op'>=</span> <span class='fl'>50</span>,
    nfold <span class='op'>=</span> <span class='fl'>10</span>,
    verbose <span class='op'>=</span> <span class='fl'>1</span>,
    params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
      eta <span class='op'>=</span> <span class='fl'>0.1</span>,
      gamma <span class='op'>=</span> <span class='va'>.x</span>,
      nthread <span class='op'>=</span> <span class='fl'>24</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="tuning-results">Tuning Results</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  452         77.0087         0.0983        82.6056        0.6781
 2:  448         77.0472         0.0837        82.6143        0.4099
 3:  445         77.0877         0.0555        82.6204        0.5452
 4:  524         76.3820         0.1016        82.6213        0.5638
 5:  436         77.1400         0.0551        82.6243        0.3445
 6:  452         77.0063         0.0802        82.6287        0.5083
 7:  416         77.3305         0.0714        82.6291        0.7941
 8:  447         77.0524         0.0613        82.6352        0.5932
 9:  424         77.2553         0.0888        82.6371        0.8803
10:  465         76.9038         0.0983        82.6379        0.5911
    eta gamma
 1: 0.1    10
 2: 0.1    50
 3: 0.1    30
 4: 0.1    55
 5: 0.1    70
 6: 0.1    80
 7: 0.1    45
 8: 0.1    15
 9: 0.1    20
10: 0.1    40</code></pre>
<p><img src="ML_models_files/figure-html5/unnamed-chunk-5-1.png" width="768" /></p>
</div>
<p>As indicated in the results, a gamma of 10 produced the best fit the to test folds. A gamma of 50 was considered as a potential alternative given its lower RMSE SD; however, 50 was considered too extreme of a regularization setting.</p>
<p>A follow-up gamma tuning process was conducted with a narrowed range of 5 to 15 and is reported below.</p>
<p><code>grid &lt;- expand.grid(loss_reduction = seq(5, 15, 1))</code></p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  426         77.1033         0.0673        82.6085        0.5934
 2:  440         76.9364         0.0804        82.6233        0.6727
 3:  411         77.2343         0.0918        82.6301        0.5782
 4:  470         76.7071         0.0412        82.6407        0.4116
 5:  452         76.8494         0.0946        82.6417        0.5207
 6:  497         76.4667         0.0793        82.6423        0.3931
 7:  478         76.6126         0.0703        82.6454        0.3906
 8:  427         77.0770         0.0583        82.6646        0.5045
 9:  389         77.4035         0.1140        82.6658        0.6899
10:  381         77.5321         0.0441        82.6747        0.4971
    eta gamma
 1: 0.1    12
 2: 0.1    13
 3: 0.1    15
 4: 0.1    14
 5: 0.1    11
 6: 0.1     9
 7: 0.1     6
 8: 0.1     8
 9: 0.1     7
10: 0.1     5</code></pre>
<p><img src="ML_models_files/figure-html5/unnamed-chunk-6-1.png" width="768" /></p>
</div>
<p>After second round of tuning, a gamma value of 12 produced the best fit.</p>
<p><strong>Best <code>gamma</code> value = 12</strong></p>
<p><strong>RMSE/SD to beat = 82.6085/0.5934</strong></p>
<h2 id="follow-up-tree-parameter-tuning">Follow-up Tree-Parameter Tuning</h2>
<h3 id="create-grid">Create Grid</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># Set learning rate, tune tree specific parameters</span>
<span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'>grid_max_entropy</span><span class='op'>(</span><span class='fu'>min_n</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>12</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># min_child_weight</span>
                         <span class='fu'>tree_depth</span><span class='op'>(</span><span class='op'>)</span>, <span class='co'># max_depth</span>
                         size <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>grid</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 2
  min_n tree_depth
  &lt;int&gt;      &lt;int&gt;
1    12         13
2    10         12
3     7         12
4     8          5
5     9         14
6     5          7</code></pre>
</div>
<h3 id="specify-model">Specify Model</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>tree_mods</span> <span class='op'>&lt;-</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>grid</span><span class='op'>$</span><span class='va'>min_n</span>, <span class='va'>grid</span><span class='op'>$</span><span class='va'>tree_depth</span>, <span class='op'>~</span><span class='op'>{</span>
  <span class='fu'>xgb.cv</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>train_x</span>,
    label <span class='op'>=</span> <span class='va'>train_y</span>,
    nrounds <span class='op'>=</span> <span class='fl'>5000</span>,
    objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
    early_stopping_rounds <span class='op'>=</span> <span class='fl'>50</span>, 
    nfold <span class='op'>=</span> <span class='fl'>10</span>,
    verbose <span class='op'>=</span> <span class='fl'>1</span>,
    params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> 
      eta <span class='op'>=</span> <span class='fl'>0.1</span>,
      gamma <span class='op'>=</span> <span class='fl'>12</span>, 
      min_child_weight <span class='op'>=</span> <span class='va'>.x</span>,
      max_depth <span class='op'>=</span> <span class='va'>.y</span>,
      nthread <span class='op'>=</span> <span class='fl'>24</span>
    <span class='op'>)</span> 
  <span class='op'>)</span>  
<span class='op'>}</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<h3 id="tuning-results-1">Tuning Results</h3>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-22256d43b8060025179a" style="width:960px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-22256d43b8060025179a">{"x":{"visdat":{"efc316738e8d":["function () ","plotlyVisDat"]},"cur_data":"efc316738e8d","attrs":{"efc316738e8d":{"x":{},"y":{},"z":{},"marker":{"size":5},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"min_child_weight"},"yaxis":{"title":"max_depth"},"zaxis":{"title":"test_rmse_mean"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[42,47,33,31,39,18,41,31,49,50,50,8,18,38,2,22,22,49,10,37,13,38,23,29,31,10,1,5,44,3],"y":[9,7,9,5,7,5,5,6,4,10,11,5,8,11,7,3,11,13,9,3,11,14,14,15,2,13,11,13,1,1],"z":[82.5145417,82.5371338,82.5425514,82.5442901,82.5475464,82.5559967,82.5578004,82.5624109,82.5731157,82.5927047,82.6007805,82.601892,82.6220056,82.6244148,82.6763656,82.6869271,82.6877203,82.6914842,82.7015336,82.7148949,82.79383,82.814676,82.9005066,82.9449509,82.9704437,83.0080811,83.0145393,83.1440653,84.5998801,84.6120261],"marker":{"colorbar":{"title":"test_rmse_mean","ticklen":2},"cmin":82.5145417,"cmax":84.6120261,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666641","rgba(70,19,97,1)"],["0.083333333333335","rgba(72,32,111,1)"],["0.124999999999999","rgba(71,45,122,1)"],["0.16666666666667","rgba(68,58,128,1)"],["0.208333333333334","rgba(64,70,135,1)"],["0.249999999999998","rgba(60,82,138,1)"],["0.291666666666669","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.374999999999997","rgba(46,114,142,1)"],["0.416666666666668","rgba(42,123,142,1)"],["0.458333333333332","rgba(38,133,141,1)"],["0.499999999999997","rgba(37,144,140,1)"],["0.541666666666668","rgba(33,154,138,1)"],["0.583333333333332","rgba(39,164,133,1)"],["0.625000000000003","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333331","rgba(79,191,110,1)"],["0.750000000000002","rgba(98,199,98,1)"],["0.791666666666666","rgba(119,207,85,1)"],["0.833333333333337","rgba(147,214,70,1)"],["0.875000000000001","rgba(172,220,52,1)"],["0.916666666666665","rgba(199,225,42,1)"],["0.958333333333336","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[82.5145417,82.5371338,82.5425514,82.5442901,82.5475464,82.5559967,82.5578004,82.5624109,82.5731157,82.5927047,82.6007805,82.601892,82.6220056,82.6244148,82.6763656,82.6869271,82.6877203,82.6914842,82.7015336,82.7148949,82.79383,82.814676,82.9005066,82.9449509,82.9704437,83.0080811,83.0145393,83.1440653,84.5998801,84.6120261],"size":5,"line":{"colorbar":{"title":"","ticklen":2},"cmin":82.5145417,"cmax":84.6120261,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666641","rgba(70,19,97,1)"],["0.083333333333335","rgba(72,32,111,1)"],["0.124999999999999","rgba(71,45,122,1)"],["0.16666666666667","rgba(68,58,128,1)"],["0.208333333333334","rgba(64,70,135,1)"],["0.249999999999998","rgba(60,82,138,1)"],["0.291666666666669","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.374999999999997","rgba(46,114,142,1)"],["0.416666666666668","rgba(42,123,142,1)"],["0.458333333333332","rgba(38,133,141,1)"],["0.499999999999997","rgba(37,144,140,1)"],["0.541666666666668","rgba(33,154,138,1)"],["0.583333333333332","rgba(39,164,133,1)"],["0.625000000000003","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333331","rgba(79,191,110,1)"],["0.750000000000002","rgba(98,199,98,1)"],["0.791666666666666","rgba(119,207,85,1)"],["0.833333333333337","rgba(147,214,70,1)"],["0.875000000000001","rgba(172,220,52,1)"],["0.916666666666665","rgba(199,225,42,1)"],["0.958333333333336","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[82.5145417,82.5371338,82.5425514,82.5442901,82.5475464,82.5559967,82.5578004,82.5624109,82.5731157,82.5927047,82.6007805,82.601892,82.6220056,82.6244148,82.6763656,82.6869271,82.6877203,82.6914842,82.7015336,82.7148949,82.79383,82.814676,82.9005066,82.9449509,82.9704437,83.0080811,83.0145393,83.1440653,84.5998801,84.6120261]}},"type":"scatter3d","mode":"markers","frame":null},{"x":[1,50],"y":[1,15],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"test_rmse_mean","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":82.5145417,"cmax":84.6120261,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666641","rgba(70,19,97,1)"],["0.083333333333335","rgba(72,32,111,1)"],["0.124999999999999","rgba(71,45,122,1)"],["0.16666666666667","rgba(68,58,128,1)"],["0.208333333333334","rgba(64,70,135,1)"],["0.249999999999998","rgba(60,82,138,1)"],["0.291666666666669","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.374999999999997","rgba(46,114,142,1)"],["0.416666666666668","rgba(42,123,142,1)"],["0.458333333333332","rgba(38,133,141,1)"],["0.499999999999997","rgba(37,144,140,1)"],["0.541666666666668","rgba(33,154,138,1)"],["0.583333333333332","rgba(39,164,133,1)"],["0.625000000000003","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333331","rgba(79,191,110,1)"],["0.750000000000002","rgba(98,199,98,1)"],["0.791666666666666","rgba(119,207,85,1)"],["0.833333333333337","rgba(147,214,70,1)"],["0.875000000000001","rgba(172,220,52,1)"],["0.916666666666665","rgba(199,225,42,1)"],["0.958333333333336","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[82.5145417,84.6120261],"line":{"color":"rgba(255,127,14,1)"}},"z":[82.5145417,84.6120261],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  426         77.1033         0.0673        82.6085        0.5934
 2:  440         76.9364         0.0804        82.6233        0.6727
 3:  411         77.2343         0.0918        82.6301        0.5782
 4:  470         76.7071         0.0412        82.6407        0.4116
 5:  452         76.8494         0.0946        82.6417        0.5207
 6:  497         76.4667         0.0793        82.6423        0.3931
 7:  478         76.6126         0.0703        82.6454        0.3906
 8:  427         77.0770         0.0583        82.6646        0.5045
 9:  389         77.4035         0.1140        82.6658        0.6899
10:  381         77.5321         0.0441        82.6747        0.4971
    eta gamma
 1: 0.1    12
 2: 0.1    13
 3: 0.1    15
 4: 0.1    14
 5: 0.1    11
 6: 0.1     9
 7: 0.1     6
 8: 0.1     8
 9: 0.1     7
10: 0.1     5</code></pre>
</div>
<p>A <code>min_child_weight</code> of <strong>42</strong> and <code>max_depth</code> of <strong>9</strong> demonstrate the best fit to the test folds and have a low SD relative to other hyperparameter tunings.</p>
<p>Tuning Summary:</p>
<ul>
<li><p><code>gamma</code> = 12</p></li>
<li><p><code>min_child_weight</code> = 42</p></li>
<li><p><code>max_depth</code> = 9</p></li>
</ul>
<p><strong>Final RMSE/SD to beat: 82.5145/0.4865</strong></p>
<h2 id="approach-2-tuning-tree-parameters-first">Approach #2: Tuning Tree Parameters First</h2>
<h3 id="specify-model-1">Specify Model</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>tree_mods</span> <span class='op'>&lt;-</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>grid</span><span class='op'>$</span><span class='va'>min_n</span>, <span class='va'>grid</span><span class='op'>$</span><span class='va'>tree_depth</span>, <span class='op'>~</span><span class='op'>{</span>
  <span class='fu'>xgb.cv</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>train_x</span>,
    label <span class='op'>=</span> <span class='va'>train_y</span>,
    nrounds <span class='op'>=</span> <span class='fl'>5000</span>,
    objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
    early_stopping_rounds <span class='op'>=</span> <span class='fl'>50</span>, 
    nfold <span class='op'>=</span> <span class='fl'>10</span>,
    verbose <span class='op'>=</span> <span class='fl'>1</span>,
    params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> 
      eta <span class='op'>=</span> <span class='fl'>0.1</span>,
      min_child_weight <span class='op'>=</span> <span class='va'>.x</span>,
      max_depth <span class='op'>=</span> <span class='va'>.y</span>,
      nthread <span class='op'>=</span> <span class='fl'>24</span>
    <span class='op'>)</span> 
  <span class='op'>)</span>  
<span class='op'>}</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<h3 id="tuning-results-2">Tuning Results</h3>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-66d45421885fffdabca0" style="width:768px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-66d45421885fffdabca0">{"x":{"visdat":{"efc337c73f6":["function () ","plotlyVisDat"]},"cur_data":"efc337c73f6","attrs":{"efc337c73f6":{"x":{},"y":{},"z":{},"marker":{"size":5},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"min_child_weight"},"yaxis":{"title":"max_depth"},"zaxis":{"title":"test_rmse_mean"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[31,50,33,39,47,41,31,42,18,18,8,49,50,38,2,49,37,10,22,13,22,38,29,23,31,10,1,5,3,44],"y":[6,10,9,7,7,5,5,9,5,8,5,4,11,11,7,13,3,9,3,11,11,14,15,14,2,13,11,13,1,1],"z":[82.5124091,82.5301652,82.5313851,82.5396958,82.5406203,82.5474305,82.5509614,82.568315,82.5730545,82.5890701,82.6059165,82.6113472,82.6179329,82.6347573,82.6624367,82.6903612,82.6917137,82.7149749,82.727191,82.7310548,82.7431975,82.7834778,82.8315184,82.9064498,82.9607202,82.9930764,83.0443854,83.1455025,84.606839,84.6138031],"marker":{"colorbar":{"title":"test_rmse_mean","ticklen":2},"cmin":82.5124091,"cmax":84.6138031,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666672","rgba(70,19,97,1)"],["0.0833333333333345","rgba(72,32,111,1)"],["0.125000000000002","rgba(71,45,122,1)"],["0.166666666666669","rgba(68,58,128,1)"],["0.208333333333336","rgba(64,70,135,1)"],["0.249999999999997","rgba(60,82,138,1)"],["0.291666666666664","rgba(56,93,140,1)"],["0.333333333333331","rgba(49,104,142,1)"],["0.374999999999998","rgba(46,114,142,1)"],["0.416666666666666","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333334","rgba(39,164,133,1)"],["0.625000000000002","rgba(47,174,127,1)"],["0.666666666666669","rgba(53,183,121,1)"],["0.708333333333336","rgba(79,191,110,1)"],["0.750000000000003","rgba(98,199,98,1)"],["0.791666666666664","rgba(119,207,85,1)"],["0.833333333333331","rgba(147,214,70,1)"],["0.874999999999998","rgba(172,220,52,1)"],["0.916666666666666","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[82.5124091,82.5301652,82.5313851,82.5396958,82.5406203,82.5474305,82.5509614,82.568315,82.5730545,82.5890701,82.6059165,82.6113472,82.6179329,82.6347573,82.6624367,82.6903612,82.6917137,82.7149749,82.727191,82.7310548,82.7431975,82.7834778,82.8315184,82.9064498,82.9607202,82.9930764,83.0443854,83.1455025,84.606839,84.6138031],"size":5,"line":{"colorbar":{"title":"","ticklen":2},"cmin":82.5124091,"cmax":84.6138031,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666672","rgba(70,19,97,1)"],["0.0833333333333345","rgba(72,32,111,1)"],["0.125000000000002","rgba(71,45,122,1)"],["0.166666666666669","rgba(68,58,128,1)"],["0.208333333333336","rgba(64,70,135,1)"],["0.249999999999997","rgba(60,82,138,1)"],["0.291666666666664","rgba(56,93,140,1)"],["0.333333333333331","rgba(49,104,142,1)"],["0.374999999999998","rgba(46,114,142,1)"],["0.416666666666666","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333334","rgba(39,164,133,1)"],["0.625000000000002","rgba(47,174,127,1)"],["0.666666666666669","rgba(53,183,121,1)"],["0.708333333333336","rgba(79,191,110,1)"],["0.750000000000003","rgba(98,199,98,1)"],["0.791666666666664","rgba(119,207,85,1)"],["0.833333333333331","rgba(147,214,70,1)"],["0.874999999999998","rgba(172,220,52,1)"],["0.916666666666666","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[82.5124091,82.5301652,82.5313851,82.5396958,82.5406203,82.5474305,82.5509614,82.568315,82.5730545,82.5890701,82.6059165,82.6113472,82.6179329,82.6347573,82.6624367,82.6903612,82.6917137,82.7149749,82.727191,82.7310548,82.7431975,82.7834778,82.8315184,82.9064498,82.9607202,82.9930764,83.0443854,83.1455025,84.606839,84.6138031]}},"type":"scatter3d","mode":"markers","frame":null},{"x":[1,50],"y":[1,15],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"test_rmse_mean","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":82.5124091,"cmax":84.6138031,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666672","rgba(70,19,97,1)"],["0.0833333333333345","rgba(72,32,111,1)"],["0.125000000000002","rgba(71,45,122,1)"],["0.166666666666669","rgba(68,58,128,1)"],["0.208333333333336","rgba(64,70,135,1)"],["0.249999999999997","rgba(60,82,138,1)"],["0.291666666666664","rgba(56,93,140,1)"],["0.333333333333331","rgba(49,104,142,1)"],["0.374999999999998","rgba(46,114,142,1)"],["0.416666666666666","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333334","rgba(39,164,133,1)"],["0.625000000000002","rgba(47,174,127,1)"],["0.666666666666669","rgba(53,183,121,1)"],["0.708333333333336","rgba(79,191,110,1)"],["0.750000000000003","rgba(98,199,98,1)"],["0.791666666666664","rgba(119,207,85,1)"],["0.833333333333331","rgba(147,214,70,1)"],["0.874999999999998","rgba(172,220,52,1)"],["0.916666666666666","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[82.5124091,84.6138031],"line":{"color":"rgba(255,127,14,1)"}},"z":[82.5124091,84.6138031],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  476         77.7006         0.0998        82.5124        0.6930
 2:  164         76.2352         0.1608        82.5302        0.6939
 3:  176         76.5310         0.1472        82.5314        0.7656
 4:  386         76.8895         0.0762        82.5397        0.7031
 5:  353         77.3357         0.1209        82.5406        0.7410
 6:  841         78.0260         0.0806        82.5474        0.7158
 7:  772         78.1773         0.0749        82.5510        0.5863
 8:  180         76.7896         0.0835        82.5683        0.4212
 9:  765         77.9577         0.0949        82.5731        0.8062
10:  218         76.6201         0.0898        82.5891        0.6832
    min_child_weight max_depth
 1:               31         6
 2:               50        10
 3:               33         9
 4:               39         7
 5:               47         7
 6:               41         5
 7:               31         5
 8:               42         9
 9:               18         5
10:               18         8</code></pre>
</div>
<p>Without any <code>gamma</code> specification, the best <code>min_child_weight</code> value was 31 and the best <code>max_depth</code> was 6. They will be retained for the <code>gamma</code> tuning process.</p>
<p><strong>RMSE/SD = 82.5124/0.6930</strong></p>
<h3 id="followup-gamma-tuning">Followup Gamma Tuning</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  533         77.3554         0.0682        82.5224        0.5267
 2:  469         77.7686         0.0927        82.5352        0.8634
 3:  471         77.7354         0.0776        82.5378        0.4401
 4:  524         77.4174         0.0992        82.5383        0.6807
 5:  499         77.5734         0.0750        82.5462        0.8300
 6:  517         77.4582         0.0884        82.5475        0.7874
 7:  524         77.3996         0.0529        82.5575        0.5187
 8:  514         77.4428         0.1058        82.5591        0.4798
 9:  460         77.8339         0.0813        82.5609        0.5974
10:  473         77.7356         0.0656        82.5616        0.5277
    eta gamma min_child_weight max_depth
 1: 0.1     5               31         6
 2: 0.1    80               31         6
 3: 0.1    45               31         6
 4: 0.1    50               31         6
 5: 0.1    75               31         6
 6: 0.1    20               31         6
 7: 0.1     0               31         6
 8: 0.1    25               31         6
 9: 0.1    35               31         6
10: 0.1    10               31         6</code></pre>
<p><img src="ML_models_files/figure-html5/unnamed-chunk-12-1.png" width="768" /></p>
</div>
<p>The best RMSE was obtained with a gamma value of 5. Thus a narrower grid search was conducted around this value.</p>
<h3 id="fine-tuning-gamma">Fine Tuning Gamma</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  483         77.6636         0.0682        82.5199        0.5321
 2:  580         77.0910         0.0922        82.5308        0.7158
 3:  526         77.4045         0.0615        82.5482        0.5523
 4:  530         77.3647         0.0591        82.5531        0.7015
 5:  561         77.1607         0.0504        82.5531        0.5370
 6:  505         77.5384         0.1148        82.5568        0.7819
 7:  524         77.3996         0.0529        82.5575        0.5187
 8:  475         77.7281         0.0901        82.5679        0.6583
 9:  511         77.4975         0.1031        82.5682        0.6308
10:  498         77.6087         0.0835        82.5774        0.5429
    eta gamma min_child_weight max_depth
 1: 0.1     1               31         6
 2: 0.1     8               31         6
 3: 0.1     4               31         6
 4: 0.1     9               31         6
 5: 0.1     3               31         6
 6: 0.1    10               31         6
 7: 0.1     0               31         6
 8: 0.1     6               31         6
 9: 0.1     2               31         6
10: 0.1     5               31         6</code></pre>
<p><img src="ML_models_files/figure-html5/unnamed-chunk-13-1.png" width="768" /></p>
</div>
<p>After fine tuning gamma, the best RMSE was obtained using a value of 1. However, RMSE values did not appear to converge towards a particular value, as illustrated in the plot. Consequently, some caution is warranted for these hyperparameter values.</p>
<p><strong>Best RMSE/SD = 82.5199/0.5321</strong></p>
<h2 id="evaluating-approaches">Evaluating Approaches</h2>
<p>Approach #1: RMSE/SD = 82.5145/0.4865 Approach #2: RMSE/SD = 82.5199/0.5321</p>
<p>Tuning gamma first, followed by the tree hyperparameters yielded better RMSE during the cross validations. Thus, the hyperparameter values generated through the first tuning approach were retained.</p>
<p><strong>Updated model summary:</strong></p>
<ul>
<li><p><code>gamma</code> = 12</p></li>
<li><p><code>max_depth</code> = 6</p></li>
<li><p><code>min_child_weight</code> = 10</p></li>
</ul>
<h2 id="tune-stochastic-parameters">Tune Stochastic Parameters</h2>
<p>After tuning loss reduction and the tree hyperparameters, the stochastic parameters were tuned to identify the best subsampling of columns and cases.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<h3 id="specify-model-2">Specify Model</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sample_mods</span> <span class='op'>&lt;-</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>grid</span><span class='op'>$</span><span class='va'>mtry</span>, <span class='va'>grid</span><span class='op'>$</span><span class='va'>sample_size</span>, <span class='op'>~</span><span class='op'>{</span>
  <span class='fu'>xgb.cv</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>train_x</span>,
    label <span class='op'>=</span> <span class='va'>train_y</span>,
    nrounds <span class='op'>=</span> <span class='fl'>5000</span>,
    objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
    early_stopping_rounds <span class='op'>=</span> <span class='fl'>50</span>, 
    nfold <span class='op'>=</span> <span class='fl'>10</span>,
    verbose <span class='op'>=</span> <span class='fl'>1</span>,
    params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> 
      eta <span class='op'>=</span> <span class='fl'>0.1</span>,
      gamma <span class='op'>=</span> <span class='fl'>12</span>,
      max_depth <span class='op'>=</span> <span class='fl'>6</span>,
      min_child_weight <span class='op'>=</span> <span class='fl'>10</span>,
      colsample_bytree <span class='op'>=</span> <span class='va'>.x</span>,
      subsample <span class='op'>=</span> <span class='va'>.y</span>,
      nthread <span class='op'>=</span> <span class='fl'>24</span>
    <span class='op'>)</span> 
  <span class='op'>)</span>  
<span class='op'>}</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<h3 id="tuning-results-3">Tuning Results</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  180         76.8111         0.1001        82.4945        0.4857
 2:  162         77.0779         0.1225        82.5165        0.7459
 3:  169         76.9934         0.0828        82.5251        0.5528
 4:  176         77.1740         0.1421        82.5602        0.6855
 5:  168         77.0995         0.1517        82.5628        0.7122
 6:  190         76.7031         0.0754        82.5678        0.2103
 7:  164         77.2467         0.0799        82.5744        0.4960
 8:  154         77.5365         0.0981        82.5795        0.5072
 9:  166         77.4868         0.1162        82.5908        0.5536
10:  178         77.4601         0.0839        82.5981        0.4447
    gamma colsample_bytree subsample
 1:    10           0.7568    0.9742
 2:    10           0.8865    0.9124
 3:    10           0.8919    0.8517
 4:    10           0.4216    0.9423
 5:    10           0.7514    0.8682
 6:    10           0.6432    0.9851
 7:    10           0.5676    0.9561
 8:    10           0.8054    0.7719
 9:    10           0.4541    0.8728
10:    10           0.4216    0.8013</code></pre>
</div>
<p>Best values for <code>colsample_bytree</code> and <code>subsample</code> appear to be around values &gt;.70. A narrower grid search was completed and is summarized below. Notably, gamma was mistakenly specified as 10 (instead of 12) during this tuning process. However, this wasn’t expected to dramatically shift the tenable range of best stochastic parameter values during fine tuning.</p>
<h4 id="fine-tuning-results">Fine Tuning Results</h4>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-423465ee6147d862608b" style="width:624px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-423465ee6147d862608b">{"x":{"visdat":{"efc37bbcc0d8":["function () ","plotlyVisDat"]},"cur_data":"efc37bbcc0d8","attrs":{"efc37bbcc0d8":{"x":{},"y":{},"z":{},"marker":{"size":5},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"colsample_bytree"},"yaxis":{"title":"subsample"},"zaxis":{"title":"test_rmse_mean"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[0.891891891891892,0.972972972972973,0.983783783783784,0.87027027027027,1,0.724324324324324,0.783783783783784,0.783783783783784,0.897297297297297,0.951351351351351,0.810810810810811,0.702702702702703,0.989189189189189,0.881081081081081,0.718918918918919],"y":[0.927007813049905,0.923192792285493,0.983015414936299,0.988202998521855,0.871605546561554,0.995889350320265,0.948194551981418,0.822707116210319,0.853748152319279,0.805553600337862,0.874723727739847,0.842035616245513,0.838072781023439,0.806630534243683,0.912923206869853],"z":[82.5002296,82.5245126,82.5343529,82.5375488,82.5563118,82.5563462,82.567076,82.571678,82.5793435,82.5839614,82.5863265,82.597895,82.5998147,82.6007409,82.608178],"marker":{"colorbar":{"title":"test_rmse_mean","ticklen":2},"cmin":82.5002296,"cmax":82.608178,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666008","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125000000000066","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333268","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666732","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.374999999999934","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333399","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666601","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625000000000066","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333268","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666732","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.874999999999934","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333399","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[82.5002296,82.5245126,82.5343529,82.5375488,82.5563118,82.5563462,82.567076,82.571678,82.5793435,82.5839614,82.5863265,82.597895,82.5998147,82.6007409,82.608178],"size":5,"line":{"colorbar":{"title":"","ticklen":2},"cmin":82.5002296,"cmax":82.608178,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666008","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125000000000066","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333268","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666732","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.374999999999934","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333399","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666601","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625000000000066","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333268","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666732","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.874999999999934","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333399","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[82.5002296,82.5245126,82.5343529,82.5375488,82.5563118,82.5563462,82.567076,82.571678,82.5793435,82.5839614,82.5863265,82.597895,82.5998147,82.6007409,82.608178]}},"type":"scatter3d","mode":"markers","frame":null},{"x":[0.702702702702703,1],"y":[0.805553600337862,0.995889350320265],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"test_rmse_mean","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":82.5002296,"cmax":82.608178,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666008","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125000000000066","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333268","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666732","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.374999999999934","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333399","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666601","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625000000000066","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333268","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666732","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.874999999999934","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333399","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[82.5002296,82.608178],"line":{"color":"rgba(255,127,14,1)"}},"z":[82.5002296,82.608178],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre><code>    iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
 1:  201         76.2962         0.1157        82.5002        0.7741
 2:  164         76.9645         0.0987        82.5245        0.3507
 3:  202         76.2556         0.0651        82.5344        0.4445
 4:  201         76.3411         0.1021        82.5375        0.7820
 5:  171         76.8405         0.1879        82.5563        1.0331
 6:  204         76.4118         0.0689        82.5563        0.4480
 7:  182         76.6834         0.0717        82.5671        0.5603
 8:  152         77.5125         0.0959        82.5717        0.7425
 9:  162         77.1778         0.0651        82.5793        0.4789
10:  143         77.6607         0.1106        82.5840        0.8543
    gamma colsample_bytree subsample
 1:    12           0.8919    0.9270
 2:    12           0.9730    0.9232
 3:    12           0.9838    0.9830
 4:    12           0.8703    0.9882
 5:    12           1.0000    0.8716
 6:    12           0.7243    0.9959
 7:    12           0.7838    0.9482
 8:    12           0.7838    0.8227
 9:    12           0.8973    0.8537
10:    12           0.9514    0.8056</code></pre>
</div>
<p>Best value of <code>colsample_bytree</code> = .892</p>
<p>Best value of <code>subsample</code> = .927</p>
<p><strong>Updated model summary:</strong></p>
<ul>
<li><p><code>gamma</code> = 12</p></li>
<li><p><code>max_depth</code> = 6</p></li>
<li><p><code>min_child_weight</code> = 10</p></li>
<li><p><code>colsample_bytree</code> = .892</p></li>
<li><p><code>subsample</code> = .927</p></li>
</ul>
<h2 id="retune-learning-rate">Retune Learning Rate</h2>
<h3 id="specify-model-3">Specify Model</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.0001</span>, <span class='fl'>0.1</span>, length.out <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>

<span class='va'>lr_mods</span> <span class='op'>&lt;-</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>lr</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>learn_rate</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>xgb.cv</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>train_x</span>,
    label <span class='op'>=</span> <span class='va'>train_y</span>,
    nrounds <span class='op'>=</span> <span class='fl'>5000</span>,
    objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
    early_stopping_rounds <span class='op'>=</span> <span class='fl'>50</span>,
    nfold <span class='op'>=</span> <span class='fl'>10</span>,
    verbose <span class='op'>=</span> <span class='fl'>0</span>,
    params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
      eta <span class='op'>=</span> <span class='va'>learn_rate</span>,
      gamma <span class='op'>=</span> <span class='fl'>12</span>,
      max_depth <span class='op'>=</span> <span class='fl'>6</span>,
      min_child_weight <span class='op'>=</span> <span class='fl'>10</span>,
      colsample_bytree <span class='op'>=</span> <span class='fl'>0.8918919</span>,
      subsample <span class='op'>=</span> <span class='fl'>0.9270078</span>,
      nthread <span class='op'>=</span> <span class='fl'>24</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The learning rate could not be re-tuned under the time constraints, so it was lowered to .04, which was identified to be the best learning rate during tuning of early models.</p>
<h1 id="tune-number-of-trees">Tune Number of Trees</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>bst</span> <span class='op'>&lt;-</span> <span class='fu'>xgb.cv</span><span class='op'>(</span>
  data <span class='op'>=</span> <span class='va'>train_x</span>,
  label <span class='op'>=</span> <span class='va'>train_y</span>,
  nrounds <span class='op'>=</span> <span class='fl'>10000</span>,
  objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
  early_stopping_rounds <span class='op'>=</span> <span class='fl'>50</span>,
  nfold <span class='op'>=</span> <span class='fl'>10</span>,
  verbose <span class='op'>=</span> <span class='fl'>1</span>,
  params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    eta <span class='op'>=</span> <span class='fl'>.04</span>,
  gamma <span class='op'>=</span> <span class='fl'>12</span>,
  max_depth <span class='op'>=</span> <span class='fl'>6</span>,
  min_child_weight <span class='op'>=</span> <span class='fl'>10</span>,
  colsample_bytree <span class='op'>=</span> <span class='fl'>0.8918919</span>,
  subsample <span class='op'>=</span> <span class='fl'>0.9270078</span>,
  nthread <span class='op'>=</span> <span class='fl'>24</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>   iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std
1: 1119        77.19118     0.05822473       82.45213     0.4973091</code></pre>
</div>
<p>Best iteration was 1119. Only 1119 trees will be specified in final fit.</p>
<h1 id="final-fit-statistics">Final Fit Statistics</h1>
<h3 id="generate-final-fit">Generate Final Fit</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>final_mod</span> <span class='op'>&lt;-</span> <span class='fu'>xgboost</span><span class='op'>(</span>
  data <span class='op'>=</span> <span class='va'>train_x</span>,
  label <span class='op'>=</span> <span class='va'>train_y</span>,
  nrounds <span class='op'>=</span> <span class='fl'>1119</span>,
  objective <span class='op'>=</span> <span class='st'>"reg:squarederror"</span>,
  verbose <span class='op'>=</span> <span class='fl'>1</span>,
  params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    eta <span class='op'>=</span> <span class='fl'>.04</span>,
  gamma <span class='op'>=</span> <span class='fl'>12</span>,
  max_depth <span class='op'>=</span> <span class='fl'>6</span>,
  min_child_weight <span class='op'>=</span> <span class='fl'>10</span>,
  colsample_bytree <span class='op'>=</span> <span class='fl'>0.8918919</span>,
  subsample <span class='op'>=</span> <span class='fl'>0.9270078</span>,
  nthread <span class='op'>=</span> <span class='fl'>24</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="fit-to-test-set">Fit to test set</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>baked_test</span> <span class='op'>&lt;-</span> <span class='fu'>prep</span><span class='op'>(</span><span class='va'>rec</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>bake</span><span class='op'>(</span><span class='va'>test</span><span class='op'>)</span>

<span class='va'>test_x</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.matrix.html'>data.matrix</a></span><span class='op'>(</span><span class='va'>baked_test</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>73</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>final_mod</span>, <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>test_x</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>actual</span> <span class='op'>&lt;-</span> <span class='va'>baked_test</span><span class='op'>$</span><span class='va'>score</span>

<span class='fu'>Metrics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Metrics/man/rmse.html'>rmse</a></span><span class='op'>(</span><span class='va'>actual</span>, <span class='va'>pred</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="final-fit-results">Final Fit Results</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>[1] 78.86593</code></pre>
</div>
<p>After tuning hyperparameters, reducing the learning rate, and determining the number of trees, the final RMSE on the test split is <strong>78.86593</strong>. This was only slightly higher than the RMSE calculated during the final fit to the training data, which was <strong>77.51970</strong>.</p>
<p>This model was submitted 20 minutes late to the Kaggle competition, but received a RMSE of <strong>81.65183</strong> on the 30% test set for the public leaderboard, and an RMSE of <strong>82.07486</strong> for the private leaderboard.</p>
<h3 id="feature-importance-plot-of-final-model-top-35">Feature Importance Plot of Final Model (Top 35)</h3>
<div class="layout-chunk" data-layout="l-body">
<p><img src="ML_models_files/figure-html5/unnamed-chunk-24-1.png" width="624" /></p>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/11-29-20_Chris/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=XG%20Boost&amp;url=https%3A%2F%2Fgithub.com%2Faashayadav%2Fposts%2F11-29-20_Chris%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fgithub.com%2Faashayadav%2Fposts%2F11-29-20_Chris%2F&amp;title=XG%20Boost">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fgithub.com%2Faashayadav%2Fposts%2F11-29-20_Chris%2F">
        <i class="fab fa-facebook"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://Machine Learning.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'https://github.com/aashayadav/posts/11-29-20_Chris/';
  this.page.identifier = 'posts/11-29-20_Chris/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://Machine Learning.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
