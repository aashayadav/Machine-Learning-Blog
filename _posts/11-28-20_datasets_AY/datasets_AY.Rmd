---
title: "Datasets"
description: |
 Let's talk about the datasets used in the project
author:
  - name: Asha
    url:
    affiliation: University of Oregon
    affiliation_url:
date: 11-27-2020
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Learn more about creating blogs with Distill at:
# https://rstudio.github.io/distill/blog.html

library(tidyverse)
library(tidymodels)
library(baguette)
library(future)
library(here)
library(rio)
library(skimr)
```
## 1. Introduction
For this project, we collected and joined five structured datasets. Datasets are selected on the basis of variables that were correlated with the outcome variable. In our datasets, our outcome variable is children's score on the statewide assessment. Please see below for more information on each dataset.   

## 2. Statewide testing data
Students in every state across the nation are tested annually in reading and math in grades 3-8. Dataset used in the project are simulated from an actual statewide testing administration across the state of Oregon and the overall distribution are highly similar. Our continous outcome variable is `score` which is also presented in categorical form as `classification`. For the project, our models are run to predict the continous `score` variable. Our data contains other variables of interest (predictors) such as `gender`, `ethnicity`, `economic disadvange`, and `location`. In our simulated dataset, `school ids` are real which we used as key to join other datasets. Here is the preview of our statewide testing dataset. 

```{r, echo=FALSE}
d <- read_csv(here::here("data", "train.csv")) %>%
select(-classification) %>%
sample_frac(.01)

skim(d) %>%
    select(-starts_with("numeric.p")) # remove quartile
```

## 3. National Center for Educational Statistics (NCES)
Our second dataset is obtained from the [NCES](https://nces.ed.gov/) website. NCES dataset contains data on the number of students eligible for different free/reduced lunch categories for every school in the United States. We filtered for the state of Oregon and rearranged the dataset. We counted the number of students for each school across grades and calculated proportion of children eligible for free/reduced lunch. We joined this dataset with the [Statewide testing dataset](2. Statewide testing data). Here is the preview of our NCES dataset.

```{r, echo=FALSE}

frl<- import("https://nces.ed.gov/ccd/Data/zip/ccd_sch_033_1718_l_1a_083118.zip",
            setclass = "tbl_df")  %>% 
  janitor::clean_names()  %>% 
  filter(st == "OR")  %>%
  select(ncessch, lunch_program, student_count)  %>% 
  mutate(student_count = replace_na(student_count, 0))  %>% 
  pivot_wider(names_from = lunch_program,
              values_from = student_count)  %>% 
  janitor::clean_names()  %>% 
  mutate(ncessch = as.double(ncessch))

skim(frl) %>%
    select(-starts_with("numeric.p")) #remove quartile

```

## 4. Student count dataset
Student count dataset was provided by the course instructor, [Prof. Daniel Anderson](https://education.uoregon.edu/people/faculty/daniela) which was used in his research in [School Achievement Gap Variability](https://github.com/datalorax/ach-gap-variability). Student count dataset contains data on school-level achievement gaps for the academic year by grade and content area and longitude and latitude values for schools in Oregon. Here is the preview of the dataset.

```{r}
stu_counts <- import("https://github.com/datalorax/ach-gap-variability/raw/master/data/achievement-gaps-geocoded.csv",
                     setclass = "tbl_df")  %>% 
  filter(state == "OR" & year == 1718)  %>% 
  count(ncessch, wt = n)  %>% 
  mutate(ncessch = as.double(ncessch))


skim(stu_counts)  # remove quartile


```

## 5. Fall membership report data
[The Oregon Department for Education (ODE)](https://www.oregon.gov/ode/reports-and-data/students/Pages/Student-Enrollment-Reports.aspx) publicly releases student enrollment reports detailing the number of K-12 students who are enrolled on the first school day in October of each year.This report is known as `Fall membership report` which contains data on race/ethinicity percentages for schools in Oregon. Here is the preview of our data.

```{r, echo=FALSE}

library(readxl)

sheets <- readxl::excel_sheets(here::here("data",
"fallmembershipreport_20192020.xlsx"))

ode_schools <- readxl::read_xlsx(here::here("data",
"fallmembershipreport_20192020.xlsx"), sheet = sheets[4])

ethnicities <- ode_schools %>%
select(attnd_schl_inst_id = `Attending School ID`,
sch_name = `School Name`,
contains("%")) %>%
  janitor::clean_names()

names(ethnicities) <- gsub("x2019_20_percent", "p", names(ethnicities))

skimr::skim(ethnicities) %>%
  select(-starts_with("numeric.p")) #remove quartile



```

## 6. Zipcode level data (bonus)

We retrieved another dataset that contains k-12 population-level data as per zip code such as `teacher-pupil ratio`, percentage of people with `high school`, `no diploma`, and `higher education`.  

```{r}
bonus_data <- import(here::here("data", "bonus_data.csv"))
skim(bonus_data) %>%
  select(-starts_with("numeric.p")) #remove quartile

```

